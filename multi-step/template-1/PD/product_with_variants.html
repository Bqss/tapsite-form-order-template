<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Variants (Multi-Step)</title>
  <script src="https://cdn.tailwindcss.com/3.4.16"></script>
</head>

<body
  data-products='[{"id":"SKU-001","name":"IKAN","price":2000,"discount_price":0,"description":"adsfafsdsdadsf","image_url":"","is_addon":false,"quantity":1,"is_required":true,"allow_custom_price":false,"variants":[{"id":"SKU-001-red","name":"Merah","price":3000},{"id":"XL","name":"XL","price":3500}],"weight":200}]'
  data-fields='{"fields":[{"id":"name","label":"Nama","type":"text","required":true},{"id":"email","label":"Email","type":"email","required":false},{"id":"phone","label":"Nomor Telepon","type":"tel","required":true}]}'
  data-couriers='["JNE","JNECargo","SiCepat","SiCepatCargo","SAP","SapCargo","iDexpress","JT","lion","iDexpressCargo","paxel","Ninja"]'
  data-domain="http://localhost:5556" data-origin-id="5fc63944f8f44b34aa4c819e">
  <section class="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 py-8 px-4 sm:px-6 lg:px-8">
    <div class="w-full max-w-sm sm:max-w-md md:max-w-2xl lg:max-w-3xl mx-auto">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Form order A</h1>
        <p class="text-gray-600">Beli produk anda disini</p>
      </div>

      <!-- Form Container -->
      <div class="bg-white rounded-2xl shadow-xl overflow-hidden">

        <form id="orderForm" class="p-6 sm:p-8 lg:p-10">
          <!-- Multi-Step Stepper Header -->
          <div id="msStepper" class="mb-6">
            <div class="flex items-center justify-between">
              <div class="flex-1 flex flex-col items-center">
                <div class="w-9 h-9 rounded-full flex items-center justify-center border-2 border-indigo-500 text-indigo-600 font-bold" data-step-circle="0">1</div>
                <div class="mt-2 text-xs sm:text-sm font-medium text-indigo-600" data-step-label="0">Produk</div>
              </div>
              <div class="flex-1 h-0.5 bg-indigo-200 mx-2" data-step-line="0"></div>
              <div class="flex-1 flex flex-col items-center">
                <div class="w-9 h-9 rounded-full flex items-center justify-center border-2 border-gray-300 text-gray-400 font-bold" data-step-circle="1">2</div>
                <div class="mt-2 text-xs sm:text-sm font-medium text-gray-400" data-step-label="1">Identitas</div>
              </div>
              <div class="flex-1 h-0.5 bg-indigo-200 mx-2" data-step-line="1"></div>
              <div class="flex-1 flex flex-col items-center">
                <div class="w-9 h-9 rounded-full flex items-center justify-center border-2 border-gray-300 text-gray-400 font-bold" data-step-circle="2">3</div>
                <div class="mt-2 text-xs sm:text-sm font-medium text-gray-400" data-step-label="2">Ringkasan</div>
              </div>
            </div>
          </div>

          <!-- Product Selection -->
          <div data-role="parent" class="mb-8 sm:mb-10">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
              <span class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold text-sm mr-2">1</span>
              Pilih Produk
            </h2>
            <div class="flex flex-col gap-2" id="products">
              <!-- Main Product -->
              <div data-role="product" data-product-id="KPRI01" class="bg-white rounded-xl shadow-md overflow-hidden transition-shadow duration-300 hover:shadow-lg">
                <div class="md:flex">
                  <div class="md:flex-shrink-0 relative">
                    <div class="h-48 w-full md:w-64  from-indigo-100   items-center justify-center overflow-hidden">
                      <img data-value="image_url" src="https://placehold.co/300x300/e2e8f0/64748b?text=Produk+Utama" alt="Produk Utama" class="w-full h-full object-cover rounded-xl shadow-lg transform transition duration-300 hover:scale-105">
                    </div>
                  </div>
                  <div class="p-6">
                    <h3 class="text-2xl font-bold text-gray-900 mb-2" data-value="name">Produk Utama</h3>
                    <p class="text-gray-600 mb-4" data-value="description">Deskripsi produk utama.</p>
                    <div class="flex items-baseline mb-4">
                      <span class="text-3xl font-bold text-indigo-600" data-value="price">Rp 500.000</span>
                    </div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Variants</label>
                    <div data-role="variants-container" class="flex flex-col gap-2">
                      <!-- Variants will be injected here -->
                    </div>
                  </div>
                </div>
              </div>

              <div data-template="variant-item" class="hidden" data-placeholder="true">
                <button type="button" data-role="variant-chip" class="px-3 py-1 rounded-full border border-indigo-200 text-sm font-medium text-gray-700 hover:bg-indigo-50 hover:border-indigo-400 transition">
                  <span data-value="name"></span>
                  <span class="ml-2 text-indigo-600 font-semibold" data-value="price"></span>
                </button>
              </div>
            </div>
          </div>

          <!-- Identity Information -->
          <div data-role="parent" class="mb-8 sm:mb-10">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
              <span class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold text-sm mr-2">2</span>
              Informasi Identitas
            </h2>

            <div class="space-y-6" id="forms">
              <div data-role="field" data-template="field">
                <label for="name" class="block text-base sm:text-sm font-medium text-gray-700 mb-2" data-value="label">Nama <span class="text-red-500">*</span></label>
                <input type="text" id="name" name="name" required data-value-id data-value-type data-value-required class="w-full px-4 py-4 sm:py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-base" placeholder="Masukkan nama lengkap Anda">
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div data-role="parent" class="mb-8 sm:mb-10">
            <h2 class="text-xl font-bold text-gray-900 mb-4 flex items-center">
              <span class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold text-sm mr-2">3</span>
              Ringkasan Pesanan
            </h2>

            <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 border border-blue-100">
              <div class="space-y-4">
                <div id="summaryItems" class="space-y-3"></div>
                <div id="summaryItemTemplate" data-template="summary-item" data-role="summary-item" class="flex justify-between items-center pb-3 border-b border-blue-100 hidden" data-placeholder="true">
                  <div>
                    <h3 class="font-semibold text-gray-900" data-summary="name">Test</h3>
                    <p class="text-sm text-gray-500">Berat: <span data-summary="weight">1000</span>g</p>
                  </div>
                  <div class="text-right">
                    <p class="text-sm text-gray-500">Rp <span data-summary="unit_price">10.000</span> Ã— <span data-summary="qty">1</span></p>
                    <p class="font-semibold text-gray-900">Rp <span data-summary="line_total">0</span></p>
                  </div>
                </div>

                <div class="flex justify-between items-center ">
                  <h3 class="text-lg font-bold text-gray-900">Total</h3>
                  <p class="text-xl font-bold text-blue-600">Rp <span id="totalPrice">20.000</span></p>
                </div>
              </div>
            </div>
          </div>

          <!-- Trust Elements -->
          <div class="mb-6">
            <div class="flex flex-wrap items-center justify-center gap-4 text-sm text-gray-500">
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-1" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                Pembayaran Aman
              </div>
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500 mr-1" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                </svg>
                Data Terenkripsi
              </div>
            </div>
          </div>

          <!-- Navigation for multi-step -->
          <div id="msNav" class="flex justify-between items-center gap-3 mt-2 mb-4">
            <button type="button" id="prevStep" class="px-6 py-3 rounded-lg border border-indigo-300 text-indigo-700 bg-indigo-50 hover:bg-indigo-100">Sebelumnya</button>
            <button type="button" id="nextStep" class="px-6 py-3 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">Lanjut</button>
          </div>

          <!-- Submit Button -->
          <div class="flex justify-center">
            <button type="submit" id="submitBtn" class="w-full sm:w-auto px-8 py-5 sm:py-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 min-h-14 sm:min-h-12 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
              Selesaikan Pesanan
            </button>
          </div>
        </form>
      </div>

      <!-- Success Message -->
      <div id="successMessage" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4 transform transition-all duration-300 scale-95 opacity-0" id="successContent">
          <div class="text-center">
            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-500" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Pesanan Berhasil!</h3>
            <p class="text-gray-600 mb-6">Terima kasih telah melakukan pemesanan. Anda akan diarahkan ke halaman pembayaran.</p>
            <div class="w-full bg-gray-200 rounded-full h-2">
              <div class="bg-blue-600 h-2 rounded-full" id="progressBar" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <script>
    // Original logic from template (render variants, summary, etc.)
    const domain = document.body.dataset.domain || '';
    const originId = document.body.dataset.originId || '';
    const submitEvent = document.body.dataset.submitEvent || '';

    const productsContainer = document.getElementById('products');
    const summaryItemsContainer = document.getElementById('summaryItems');
    const summaryItemTemplate = document.getElementById('summaryItemTemplate');
    const totalPriceElement = document.getElementById('totalPrice');

    const productPrice = window.initialProductPrice || 0;
    const productWeight = 200;
    const orderForm = document.getElementById('orderForm');
    const submitBtn = document.getElementById('submitBtn');
    const successMessage = document.getElementById('successMessage');
    const successContent = document.getElementById('successContent');
    const progressBar = document.getElementById('progressBar');
    let debounceTimer;
    let selectedAddress = null;

    (function initProductRendering() {
      try {
        const raw = document.body.dataset.products || '[]';
        const products = JSON.parse(raw.replace(/'/g, '"'));

        const mainProduct = products.find(p => !p.is_addon);
        const mainProductContainer = document.querySelector(`[data-role="product"]`);

        if (mainProduct && mainProductContainer) {
          const img = mainProductContainer.querySelector('[data-value="image_url"]');
          if (img) img.src = mainProduct.image_url;
          mainProductContainer.querySelector('[data-value="name"]').textContent = mainProduct.name;
          mainProductContainer.querySelector('[data-value="description"]').textContent = mainProduct.description;

          const variantsContainer = mainProductContainer.querySelector('[data-role="variants-container"]');
          const variantTemplate = document.querySelector('[data-template="variant-item"]');
          const mainPriceEl = mainProductContainer.querySelector('[data-value="price"]');

          if (variantsContainer && variantTemplate && mainProduct.variants && mainProduct.variants.length > 0) {
            variantsContainer.innerHTML = '';
            mainProduct.variants.forEach((variant, index) => {
              const variantNode = variantTemplate.cloneNode(true);
              variantNode.classList.remove('hidden');
              variantNode.removeAttribute('data-template');
              const chipEl = variantNode.querySelector('[data-role="variant-chip"]');
              const nameEl = variantNode.querySelector('[data-value="name"]');
              const priceEl = variantNode.querySelector('[data-value="price"]');
              if (nameEl) nameEl.textContent = variant.name;
              if (priceEl) priceEl.textContent = `Rp ${Number(variant.price).toLocaleString('id-ID')}`;
              if (chipEl) {
                chipEl.addEventListener('click', () => {
                  Array.from(variantsContainer.querySelectorAll('[data-role="variant-chip"]')).forEach(btn => {
                    btn.classList.remove('ring-2','ring-indigo-500','bg-indigo-50','text-indigo-700');
                  });
                    chipEl.classList.add('ring-2','ring-indigo-500','bg-indigo-50','text-indigo-700');
                    onVariantSelect(mainProduct, variant);
                });
              }
              variantsContainer.appendChild(variantNode);
              if (index === 0) {
                if (chipEl) chipEl.classList.add('ring-2','ring-indigo-500','bg-indigo-50','text-indigo-700');
                mainProduct.price = variant.price;
                try {
                  const wp = (window.productsData || []).find(p => p.id === mainProduct.id);
                  if (wp) wp.price = variant.price;
                } catch (err) {}
                if (mainPriceEl) mainPriceEl.textContent = `Rp ${Number(variant.price).toLocaleString('id-ID')}`;
              }
            });
          } else {
            if (mainPriceEl) mainPriceEl.textContent = `Rp ${Number(mainProduct.price).toLocaleString('id-ID')}`;
          }
        }

        window.productsData = products.map(p => ({...p, quantity: 0}));
        window.activeProductIndex = 0;
      } catch (e) {
        console.warn('Gagal render produk dari data-products:', e);
      }
    })();

    function onVariantSelect(mainProduct, variant) {
      try {
        const wp = (window.productsData || []).find(p => p.id === mainProduct.id);
        if (wp) wp.price = variant.price;
        const mainProductContainer = document.querySelector(`[data-role="product"]`);
        const mainPriceEl = mainProductContainer.querySelector('[data-value="price"]');
        if (mainPriceEl) mainPriceEl.textContent = `Rp ${Number(variant.price).toLocaleString('id-ID')}`;
        updateSummary();
      } catch (e) {}
    }

    (function initFields() {
      try {
        const raw = document.body.dataset.fields || '{}';
        const parsed = JSON.parse(raw.replace(/'/g, '"'));
        const fields = Array.isArray(parsed.fields) ? parsed.fields : [];
        const formsContainer = document.getElementById('forms');
        const template = formsContainer ? formsContainer.querySelector('[data-role="field"]') : null;
        if (!formsContainer || !template) return;
        formsContainer.innerHTML = '';
        fields.forEach(field => {
          const el = template.cloneNode(true);
          const label = el.querySelector('[data-value="label"]');
          if (label) label.textContent = field.label;
          const input = el.querySelector('input');
          if (input) {
            input.id = field.id;
            input.name = field.id;
            input.type = field.type || 'text';
            input.required = !!field.required;
            input.placeholder = `Masukkan ${String(field.label||'').toLowerCase()}`;
          }
          formsContainer.appendChild(el);
        });
      } catch (e) {}
    })();

    function updateSummary() {
      try {
        const list = document.getElementById('summaryItems');
        const tpl = document.getElementById('summaryItemTemplate');
        list.innerHTML = '';
        const p = (window.productsData || []).find(p => !p.is_addon);
        if (!p) return;
        const el = tpl.cloneNode(true);
        el.classList.remove('hidden');
        const nameEl = el.querySelector('[data-summary="name"]');
        const qtyEl = el.querySelector('[data-summary="qty"]');
        const unitPriceEl = el.querySelector('[data-summary="unit_price"]');
        const lineTotalEl = el.querySelector('[data-summary="line_total"]');
        const weightEl = el.querySelector('[data-summary="weight"]');
        if (nameEl) nameEl.textContent = p.name;
        if (qtyEl) qtyEl.textContent = 1;
        if (unitPriceEl) unitPriceEl.textContent = Number(p.price).toLocaleString('id-ID');
        const total = Number(p.price || 0);
        if (lineTotalEl) lineTotalEl.textContent = Number(total).toLocaleString('id-ID');
        if (weightEl) weightEl.textContent = Number(p.weight || 200);
        list.appendChild(el);
        const totalPriceEl = document.getElementById('totalPrice');
        if (totalPriceEl) totalPriceEl.textContent = Number(total).toLocaleString('id-ID');
      } catch (e) {}
    }

    updateSummary();

    // Multi-step controller
    (function initMultiStep() {
      const parents = Array.from(document.querySelectorAll('#orderForm [data-role="parent"]'));
      const prevStepBtn = document.getElementById('prevStep');
      const nextStepBtn = document.getElementById('nextStep');
      const submitBtnEl = document.getElementById('submitBtn');
      const stepCircles = Array.from(document.querySelectorAll('[data-step-circle]'));
      const stepLabels = Array.from(document.querySelectorAll('[data-step-label]'));
      let stepIndex = 0;

      function refreshStepperUI() {
        stepCircles.forEach((c, idx) => {
          if (idx <= stepIndex) {
            c.classList.remove('border-gray-300', 'text-gray-400');
            c.classList.add('border-indigo-500', 'text-indigo-600');
          } else {
            c.classList.add('border-gray-300', 'text-gray-400');
            c.classList.remove('border-indigo-500', 'text-indigo-600');
          }
        });
        stepLabels.forEach((l, idx) => {
          if (idx === stepIndex) {
            l.classList.remove('text-gray-400');
            l.classList.add('text-indigo-600');
          } else {
            l.classList.add('text-gray-400');
            l.classList.remove('text-indigo-600');
          }
        });
      }

      function showStep(i) {
        stepIndex = Math.max(0, Math.min(i, parents.length - 1));
        parents.forEach((el, idx) => el.classList.toggle('hidden', idx !== stepIndex));
        prevStepBtn.disabled = stepIndex === 0;
        prevStepBtn.classList.toggle('opacity-50', stepIndex === 0);
        nextStepBtn.classList.toggle('hidden', stepIndex === parents.length - 1);
        if (submitBtnEl) submitBtnEl.classList.toggle('hidden', stepIndex !== parents.length - 1);
        refreshStepperUI();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      prevStepBtn.addEventListener('click', () => showStep(stepIndex - 1));
      nextStepBtn.addEventListener('click', () => showStep(stepIndex + 1));
      showStep(0);
    })();
  </script>
</body>

</html>